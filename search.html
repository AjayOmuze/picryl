<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Search | Picryl</title>

	<link rel="shortcut icon" href="favicon.ico" type="image/x-icon">
	<link rel="icon" href="favicon.ico" type="image/x-icon">
	<link rel="apple-touch-icon" sizes="57x57" href="apple-icon-57x57.png">
	<link rel="apple-touch-icon" sizes="60x60" href="apple-icon-60x60.png">
	<link rel="apple-touch-icon" sizes="72x72" href="apple-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="76x76" href="apple-icon-76x76.png">
	<link rel="apple-touch-icon" sizes="114x114" href="apple-icon-114x114.png">
	<link rel="apple-touch-icon" sizes="120x120" href="apple-icon-120x120.png">
	<link rel="apple-touch-icon" sizes="144x144" href="apple-icon-144x144.png">
	<link rel="apple-touch-icon" sizes="152x152" href="apple-icon-152x152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="apple-icon-180x180.png">
	<link rel="icon" type="image/png" sizes="192x192" href="android-icon-192x192.png">
	<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="96x96" href="favicon-96x96.png">
	<link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
	<link rel="manifest" href="manifest.json">
	<meta name="msapplication-TileColor" content="#ffffff">
	<meta name="msapplication-TileImage" content="ms-icon-144x144.png">
	<meta name="theme-color" content="#ffffff">

    <link href="css/bootstrap.css" rel="stylesheet" type="text/css" />
    <!-- CSS bundle -->
    <link rel="stylesheet" href="css/main.css" />
    <link href="css/style.css" rel="stylesheet" type="text/css" />
    <link href="css/custom.css" rel="stylesheet" type="text/css" />

    <link href="css/io-range-slider/ion.rangeSlider.css" rel="stylesheet" type="text/css" />
    <link href="css/io-range-slider/ion.rangeSlider.skinModern.css" rel="stylesheet" type="text/css" />
    <link href="css/io-range-slider/normalize.css" rel="stylesheet" type="text/css" />

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" />

    <link rel="stylesheet" href="css/photo.css" />
	
	
	<link rel="stylesheet" href="include/photoswipe.css"> 

    <link rel="stylesheet" href="include/default-skin/default-skin.css"> 

    <script src="include/photoswipe.min.js"></script> 

    <script src="include/photoswipe-ui-default.min.js"></script>

    <!--- This css is broken > <link rel="stylesheet" href="http://highlightjs.org/static/styles/github.css" />  --->
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.0/highlight.min.js"></script>
    <style>
	  .loading-slider {
        background-image: url("https://promotions.coca-cola.com/etc/designs/promotions/img/loading.gif") !important;
        background-repeat: no-repeat !important;
        background-size: 10% auto !important;
        background-position: center center !important;	
        height: 100%;
        width: 100%;
      }
      .pswp__button--autoplay {
        background: transparent url(./images/play_icon.png) no-repeat scroll 16px 15px !important;
      }
      .pswp__button--autoplay.stop {
        background-image: url(./images/stop_icon.png) !important; margin-top: -2px;
      }
	  .pswp--open{ position:fixed !important;}
      ul.editable-tags li{margin-bottom: 7px;} 
    </style>

<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function()
{ (i[r].q=i[r].q||[]).push(arguments)}
,i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-73235424-1', 'auto');
ga('send', 'pageview');
</script>
  
  </head>

  <body>
    <header>

    </header>


    <div id="images-loading">
      <!-- Root element of PhotoSwipe. Must have class pswp. -->
      <div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

        <!-- Background of PhotoSwipe. 
             It's a separate element, as animating opacity is faster than rgba(). -->
        <div class="pswp__bg"></div>

        <!-- Slides wrapper with overflow:hidden. -->
        <div class="pswp__scroll-wrap">

          <!-- Container that holds slides. PhotoSwipe keeps only 3 slides in DOM to save memory. -->
          <div class="pswp__container">
            <!-- don't modify these 3 pswp__item elements, data is added later on -->
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
          </div>

          <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
          <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

              <!--  Controls are self-explanatory. Order can be changed. -->

              <div class="pswp__counter"></div>

              <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

              <button class="pswp__button pswp__button--share" title="Share"></button>

              <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

              <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

              <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
              <!-- element will get class pswp__preloader--active when preloader is running -->
              <div class="pswp__preloader">
                <div class="pswp__preloader__icn">
                  <div class="pswp__preloader__cut">
                    <div class="pswp__preloader__donut"></div>
                  </div>
                </div>
              </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
              <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
              <div class="pswp__caption__center"></div>
            </div>

          </div>

        </div>

      </div>
    </div>

    <!--------------search---------------------------->
    <section>
      <div class="container">
        <div class="search_page search_result_page">

          <div class="row pTop10 row_md">
		  
            <div class="col-md-6 col-sm-6 icon_search_span">
			  <form>
                <input type="text" id="search-input" class="form-control input-search search_page_input" placeholder="Explore a world of public domain media" autocomplete="off"/>
				<span><img src="images/icon_search.png" width="22" height="22" /></span>
              </form>
			</div>
			
            <div class="col-md-6 col-sm-6">
			   <div class="title search_title">
                   <input type="text" id="date_range_picker" name="date_range_picker" value="" />
               </div>
			</div>
			
            <div class="col-md-12 col-sm-12">
              <div style="width: auto;float: left;">
                <div id="tags" class="editable-tags">
                  <ul class="editable-tags">
                    <li>                                        

                    </li>
                  </ul>
                </div>                        
              </div>

            </div>                      
          </div>            


          <div class="row  row_md">
            <div class="col-md-1 col-sm-1">
              <h4 class="related_tags_title">Related :</h4>
            </div>
            <div class="col-md-11 col-sm-11">
              <div id="related-tags" class="related-tags trending trending_m">
                <ul class="related-tags"></ul>
              </div>
            </div>
          </div>

          <div class="clearfix"></div>


          <div id="search-result">

                <div class="row row_md">
                  <div class="col-md-6 col-sm-6 col-xs-12 text-left"><h4 class="search-total-counter">Search results: <span class="result-number">0</span></h4></div>
                  <div class="col-md-6 col-sm-6 col-xs-12"><a href="#" id="play-button"><div class="blue_btn">Play Slideshow</div></a></div>
                </div>
 
            <div class="clearfix"></div>
            <hr />

            <div class="demo">
              <div class="GITheWall">
                <ul class="sample"></ul>
                <ul class="photo-list"></ul>
              </div>
            </div>

            <div class="loading" style="width: 100%; padding: 15px 0; clear: both; text-align: center;">
              <span class="loading-indicator fa fa-spinner" style="margin: 0 auto;"></span>
            </div>
          </div>

        </div>
      </div>

    </section>


    <!-----------------footer------------------->
    <footer>

    </footer>

    <!------------------fancybox------------------->

    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="js/jQuery.GI.TheWall.js"></script>


    <script>
      var GOOGLE_API_KEY = 'AIzaSyBOu3rRIkRXFtBhxcPJQVHvWGQVUa1SlxE';
      var wall = $('.GITheWall').GITheWall({
        nextButtonClass: 'fa fa-angle-right',
        prevButtonClass: 'fa fa-angle-left',
        closeButtonClass: 'fa fa-times'
      });
      $('.add-item').on('click', function () {
        $('.GITheWall ul').append('<li data-contenttype="image" data-href="http://lorempixel.com/570/570?18"><img src="http://lorempixel.com/570/570?' + Math.random() + '" /></li>');
        wall.refresh();
      });
      $('.remove-item').on('click', function () {
        $('.GITheWall ul li:last').remove();
        wall.refresh();
      });


      $(window).resize(function () {

        wall.refresh();
      })

      hljs.initHighlightingOnLoad();
    </script>

    <div class="image_details_container"></div>





    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <!-- Bootstrap -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <!-- Cookie framework -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.0.3/js.cookie.js"></script>
    <!-- Tag search module -->
    <script src="js/tag-search.static.js"></script>
    <!-- Photo selection module -->
    <script src="js/photo-select.static.js"></script>
    <!-- Photo details module -->
    <script src="js/photo-details.static.js"></script>
    <!-- JS bundle -->
    <script src="js/search.js"></script>


    <!-- My JS -->
    <script>

      $(document).ready(function () {


        var g_range_from = 0;
        var g_range_to = 0;
		var startSliderIndex = 0;
		var call_ajax_url = true;
		// build items array
		var items = [];
				
        $(document).on('click', 'ul.sample li', function () {
          // alert($('#img_inline-template'+$(this).data('id')+' .map-img').size());
          // $('#img_inline-template'+$(this).data('id')+' .map-img').attr('data-id',1);
          // $path = $('#img_inline-template'+$(this).data('id')+' .map-img').attr('src');
          // $('#img_inline-template'+$(this).data('id')+' .map-img').attr('src',$path+"&random=1");
        });


        /* includeing header footer */
        $("header").load("header.html", function () {
          $('#myNavbar').find('li').removeClass('active');
          $('#myNavbar').find('li.search_page').addClass('active');
        });
        $("footer").load("footer.html");


        var created_date_range_from = '';
        var created_date_range_to = '';
        var range_counter = 1;
        var date_range_query_check = 0;
        var null_media_counter = 0;
		
        //$('.sample').html('<li data-contenttype="inline" data-href="#inline-template100"><img src="images/search_photo02.jpg" /></li>');

        /* Add tag to a tags list when click on it */
        function addTag(tag) {
          if (tags.indexOf(tag) == -1) {
            tags.push(tag);
          }

          //parent.location.hash = (parent.location.hash + tag + '&');

          renderTags(tags);
          searchPhotos(tags);

          var newTags = tags + ''
          newTags = newTags.split(',').join('&');
          //parent.location.hash = newTags;
		  window.history.replaceState("", "", "search.html?search="+newTags);
          ////console.log(newTags);

          //$('#related-tags').show();

        }

        /* Delete tag when clicks on it */
        function deleteTag(event) {
          var index = tags.indexOf($(this).parent().data("id"));
          if (index > -1) {
            tags.splice(index, 1);
          }

          if (tags == "") {
            window.location.href = "search.html";
          }
          /*if (tags == "") {
           tagsUrl = tags;
           } else {
           tagsUrl = tags + '&';
           }*/

          //parent.location.hash = tagsUrl;

          renderTags(tags);
          searchPhotos(tags);

          var newTags = tags + ''
          newTags = newTags.split(',').join('&');
          window.history.replaceState("", "", "search.html?search="+newTags);
          ////console.log(newTags);

        }


        function searchPhotos(tags) {
          pageNumber = 1;
          clearSearchResults();
          loadPhotos(tags, pageNumber);
        }

        function loadPhotos(tags, pageNumber) {
          var resultNumberElement = $("#search-result .result-number");
          $(".loading-indicator").show();
          $('.search_page_input').attr('disabled', true);
          $('ul.related-tags').hide();
          if (pageNumber == 1) {
            resultNumberElement.html("");
          }

          var encodedTags = [];
          tags.forEach(function (tag) {
            encodedTags.push(encodeURIComponent(tag));
          });

          var periodFilter = "";

          ////console.log('searchFrom : ' + searchFrom);
          ////console.log('searchTo : ' + searchTo);
		if(date_range_query_check == 1){
          if (searchFrom != "" && searchTo == "") {
            periodFilter = "&created_date_from=" + searchFrom;
          } else if (searchFrom == "" && searchTo != "") {
            periodFilter += "&created_date_to=" + searchTo;
          } else if (searchFrom != "" && searchTo != "") {
            periodFilter = "&created_date_from=" + searchFrom
                    + "&created_date_to=" + searchTo;
          }
		 }
			
		  // for getting nodated photos
		  var created_date_null = '';
		  
		  if(null_media_counter == 0){
			created_date_null = '&created_date_null=1';			
		  }else{
			created_date_null = '';
			null_media_counter = 0;
		  }
		  
          imagesUrl = "https://api.getarchive.net/v3/media?created_date_range=1"+created_date_null+"&tags=" + encodedTags.join(",") + periodFilter;
          imagesUrl += "&rpp=40&page=" + pageNumber + "&recommend_tags=1";

          ////console.log (periodFilter);

          $.ajax({
            url: imagesUrl,
            headers: {
              "x-auth-key": "ladygaga#1"
            }
          }).done(function (data) {

            var created_date_range_from = new Date(data.created_date_range[0]);
            created_date_range_from = created_date_range_from.getFullYear();

            var created_date_range_to = new Date(data.created_date_range[1]);
            created_date_range_to = created_date_range_to.getFullYear();

            g_range_from = created_date_range_from;
            g_range_to = created_date_range_to;

            //console.log(imagesUrl + "&rpp=40&page=" + pageNumber + "&recommend_tags=1");
            //console.log(data);

            if (range_counter == 1) {
              load_photos_from_daterange(created_date_range_from, created_date_range_to);
              range_counter++;
            }else{
			
				if(date_range_query_check == 0){
					
					var slider = $("#date_range_picker").data("ionRangeSlider");
				
					slider.update({
						type: "double",
						min: created_date_range_from,
						max: created_date_range_to,
						from: created_date_range_from,
						to: created_date_range_to,
						grid: true,
						grid_num: 10,
						prettify_enabled: false
					});
					
					//console.log(created_date_range_from);
					//console.log(created_date_range_to);
				
				}else{
				
					date_range_query_check = 0;
				}
				//console.log(created_date_range_from);
				//console.log(created_date_range_to);
			}

            /* Metadata */
            maxPageNumber = data.total_pages;
            /* Photos */
            $(".loading-indicator").hide();
            $('.search_page_input').attr('disabled', false);
            $('ul.related-tags').show();
            $(".row_md").show();

            var resultElement = $("#search-result .photo-list");
            resultNumberElement.html(data.total_items);
            data.items.forEach(function (item) {

              //console.log(item);

              var imageUrl = item.resources[0].url;
              var bigImageUrl = imageUrl;
              var fullImageUrl = imageUrl;

              if (item.resources[1] && item.resources[1].url) {
                imageUrl = item.resources[1].url;
              }
              if (item.resources[2] && item.resources[2].url) {
                bigImageUrl = item.resources[2].url;
              }
              if (item.resources[4] && item.resources[4].url) {
                fullImageUrl = item.resources[4].url;
              }

              //var newItem = '<li data-contenttype="inline" data-href="#inline-template1"><img src="' + imageUrl + '"/></li>';

              $tempUrl = imagesUrl;
              var newItem = $('<li data-contenttype="inline" data-href="#inline-template' + item.id + '" style="background-image:url(' + imageUrl + ')" data-id="' + item.id + '"><div class="caption"><img src="images/right_icon.png" width="36" height="27" /></div></li>');

              var itemTags = '';
              if (item.tags.length > 0) {
                itemTags = item.tags.join(', ');
              }

              var photo_loc_html = '';
              var item_summary_html = '';
              var item_tag_html = '';
              var item_source_html = '';
              var item_rights_html = '';
              var item_source_link_html = '';
              var item_date_html = '';


              // Show Date in photo Detail [start]

              if ((item.min_created_date != '' && item.min_created_date != null) && (item.max_created_date != '' && item.max_created_date != null)) {

                var d1 = new Date(item.min_created_date);
                var year1 = d1.getFullYear();

                var d2 = new Date(item.max_created_date);
                var year2 = d2.getFullYear();

                if (year1 != year2) {

                  item_date_html = '<h4><img src="images/icons/ic_date.png" class="slideshow-icon"> Date</h4> \
              <p>' + year1 + ' - ' + year2 + '</p>';
                } else {
                  item_date_html = '<h4><img src="images/icons/ic_date.png" class="slideshow-icon"> Date</h4> \
              <p>' + year1 + '</p>';
                }
              } else if ((item.min_created_date == '' && item.min_created_date == null) && (item.max_created_date != '' && item.max_created_date != null)) {
                var d2 = new Date(item.max_created_date);
                var year2 = d2.getFullYear();

                item_date_html = '<h4><img src="images/icons/ic_date.png" class="slideshow-icon"> Date</h4> \
              <p>' + year2 + '</p>';
              } else if ((item.min_created_date != '' && item.min_created_date != null) && (item.max_created_date == '' && item.max_created_date == null)) {
                var d1 = new Date(item.min_created_date);
                var year1 = d1.getFullYear();

                item_date_html = '<h4><img src="images/icons/ic_date.png" class="slideshow-icon"> Date</h4> \
              <p>' + year1 + '</p>';
              }

              /*else {
               item_date_html = '<h4><img src="images/icons/ic_date.png" class="slideshow-icon"> Date</h4> \
               <p>' + item.min_created_date + ' --- ' + item.max_created_date + '</p>';
               }*/



              /* if (item.min_created_date != '' && item.min_created_date != null) {
               var d = new Date(item.min_created_date);
               var year = d.getFullYear();
               
               item_date_html = '<h4><img src="images/icons/ic_date.png" class="slideshow-icon"> Date</h4> \
               <p>' + year + '</p>';
               }*/
              // Show Date in photo Detail [end]

              if (item.source_url != '') {
                item_source_link_html = '<h4><img class="slideshow-icon" src="images/icons/ic_link.png" /> Link</h4> \
              <p><a target="_blnak" href="' + item.source_url + '">' + item.source_url + '</a></p>';
              }

              // console.log(item.rights);

              if (item.rights != '') {
                item_rights_html = '<h4><img class="slideshow-icon" src="images/icons/ic_rights.png" /> Rights advisory</h4> \
              <p>' + item.rights + '</p>';
              }

              if (item.source_name != '') {
                item_source_html = '<h4><img class="slideshow-icon" src="images/icons/ic_name.png" /> Source</h4> \
              <p>' + item.source_name + '</p>';
              }

              if (itemTags != '') {
                item_tag_html = '<h4><img class="slideshow-icon" src="images/icons/ic_keywords.png" /> Tags</h4> \
              <p>' + itemTags + '</p>';
              }

              if (item.summary != '') {
                item_summary_html = '<h4><img class="slideshow-icon" src="images/icons/ic_summary.png" /> Summary</h4> \
              <p>' + item.summary + '</p>';
              }

              if (item.location != null && item.latitude != null && item.longitude != null) {
                photo_loc_html = '<h4><img class="slideshow-icon" src="images/icons/ic_location.png" /> Location</h4> \
            <div class="row"> \
              <div class="col-md-12"> \
                <p>' + item.location + ' </p> \
              </div> \
              <div class="col-md-12"> \
        <a target="_blank" href="https://www.google.com/maps/place/' + item.latitude + ',' + item.longitude + '/@' + item.latitude + ',' + item.longitude + '">\
                <img alt="" class="map-img" src="https://maps.googleapis.com/maps/api/staticmap?center=' + item.latitude + ',' + item.longitude + '&zoom=11&size=230x120&markers=color:red|' + item.latitude + ',' + item.longitude + '&key=AIzaSyDsv-XvXGXCLLgpe5Ctp758Ib4dCKbJo_g" />\
        </a>\
              </div> \
            </div>';
              }
			  
			
              var newItemDetail = '<div id="inline-template' + item.id + '" style="display: none"> \
      <div class="ajax" id="img_inline-template' + item.id + '"> \
      <div class="row"> \
        <div class="col-md-7"> \
           <a data-id="' + item.id + '" data-call_url="'+ $tempUrl +'" data-url="' + $tempUrl + '" data-image_url="' + imageUrl + '" class="play_slide"><div class="photo_link"><img src="images/full_icon.png" width="28" height="28" /></div></a>	\
			<a data-id="' + item.id + '" data-call_url="'+ $tempUrl +'" data-url="' + $tempUrl + '" data-image_url="' + imageUrl + '" class="play_slide"><img src="' + bigImageUrl + '" class="img-responsive" style=" width:100%" /></a></div> \
        <div class="col-md-5"> \
        <div class="txt"> \
          <div class="row"> \
            <div class="col-md-12">\
              <div class="photo_title">' + item.name + '</div> \
            </div> \
            <div class="col-md-12"> \
              ' + item_summary_html + ' \
              ' + item_tag_html + ' \
			  ' + item_date_html + ' \
			  ' + photo_loc_html + '\
              ' + item_source_html + ' \
              ' + item_source_link_html + ' \
              ' + item_rights_html + ' \
            </div> \
          </div> \
        </div> \
        </div> \
        </div> \
      </div> \
      </div>';

              resultElement.append(newItem);

              //$('.image_details_container').append(newItemDetail);

              $('.image_details_container').append(newItemDetail);

              ////console.log(wall);


              //$('.sample').append('<li data-contenttype="inline" data-href="#inline-template100"><img src="images/search_photo02.jpg" /></li>');
              $('.sample').append(newItem);

              wall.refresh();

            });

            refreshSelection();
			call_ajax_url = true
            /* Recommended tags */
            if (data.recommended_tags.length > 0) {
              var relatedTagsList = $("#related-tags ul");
              relatedTagsList.html(""); // clean the list
              data.recommended_tags.forEach(function (tag) {
                relatedTagsList.append($("<li>" + tag + "</li>"));
              });
              $('.related_tags_title').css('display', 'block');
              $("#related-tags").show();
              /* Add related tag to the tag list on click */
              $("ul.related-tags li").click(function (event) {
                var tag = $(this).html().toLowerCase();
                addTag(tag);
              });
            } else {
              $("#related-tags").hide();
            }

            if (getUrlParameter("search") == undefined && window.location.hash == '') {
              var relatedTagsList = $("#related-tags ul");
              relatedTagsList.html(""); // clean the list
              $('.related_tags_title').css('display', 'none');
            }

          });

        }

        function load_photos_from_daterange(created_date_range_from, created_date_range_to) {

          $("#date_range_picker").ionRangeSlider({
            type: "double",
            min: created_date_range_from,
            max: created_date_range_to,
            grid: false,
            grid_num: 10,
            prettify_enabled: false,
            onFinish: function (data) {
			
              if (g_range_from != data.from || g_range_to != data.to) {
                searchFrom = data.from + "-01-01";
                searchTo = data.to + "-01-01";

                /*console.log(searchFrom);
                console.log(searchTo);*/
				
				// for not update slider when query from date range...
				date_range_query_check = 1;
				null_media_counter = 1;
                clearSearchResults();
                searchPhotos(tags);
              }else{
				null_media_counter = 0;
			  }
              ////console.log(data);
            }
          });
        }

        function clearSearchResults() {
          $(".sample").html("");
          $(".image_details_container").html("");
        }

        function renderTags(tags) {
          var tagsElement = $("#tags ul");
          tagsElement.html("");
          tags.forEach(function (tag) {
            tagsElement.append($('<li data-id="' + tag + '">' + tag + '<span class="tag-icon"><img src="images/minus_icon.png" width="20" height="20" /></span></li>'));
          });
          $("#tags .tag-icon").click(deleteTag);
        }

        function getUrlParameter(sParam) {
          var sPageURL = decodeURIComponent(window.location.search.substring(1)),
                  sURLVariables = sPageURL.split('&'),
                  sParameterName,
                  i;
          for (i = 0; i < sURLVariables.length; i++) {
            sParameterName = sURLVariables[i].split('=');
            if (sParameterName[0] === sParam) {
              return sParameterName[1] === undefined ? true : sParameterName[1];
            }
          }
        }

		// filling tags from url on refresh
        function getUrlRemainParameter(sParam) {
		
          var sPageURL = decodeURIComponent(window.location.search.substring(1)),
                  sURLVariables = sPageURL.split('&'),    
                  i;
				  
          for (i = 0; i < sURLVariables.length; i++) {
		  
            if(sURLVariables[i] !=""){
			
				if(i >0){				
					tags.push(sURLVariables[i]);
				}
            
			}
			
          }
		  
        }


        var imagesUrl = ''; // URL that is used to retrieve messages

        /* Photo selection logic */
        /*var photoClickHandler = function (itemId) {
         PhotoDetails.showPhotoDetails(this, itemId);
         };
         PhotoSelect.setParameters('#search-result li', $("#add-button"), photoClickHandler);*/

        var refreshSelection = PhotoSelect.refreshSelection;
        /* Slideshow logic */
        $("#play-button").click(function () {
          // alert(imagesUrl); 
          //window.open('slideshow.html?url=' + encodeURIComponent(imagesUrl) + '&auto_play=1');
		 // Prepare url to retrieve photos for all
         
		  items = [];
		  startSliderIndex = 0;		  
		  swiperSliderCallURL(imagesUrl, 0, 1);
        });

        /* Search logic */
        {

          var searchText = "";
          var pageNumber = 1;
          var maxPageNumber = 1;
          var tags = [];
          var searchFrom = "";
          var searchTo = "";
          /* Tag search logic */
//                    function tagSelectHandler(tag) {
//                        window.location.href = "search.html?search=" + tag;
//                    }
          convertToTagSearch($("#search-input"), addTag);
          //convertToTagSearch($("#search-input-small"), addTag);

          /* Auto Search photos if there is URL parameter */
          if (getUrlParameter("search") !== undefined
                  && getUrlParameter("search") !== "") {
            tags.push(getUrlParameter("search"));
			
			getUrlRemainParameter("search");			
          }
          renderTags(tags);
          searchPhotos(tags);
          /* Infinite scroll */
          $(window).scroll(function () {
		  
			  if ($(window).scrollTop() + $(window).height() > $(document).height() - 100)
			  {
			  
				if (pageNumber < maxPageNumber) {
					
					if(call_ajax_url == true){
						call_ajax_url = false;
						loadPhotos(tags, ++pageNumber);
						
					}
						
				}
			  }
			  
          });
          /* Filters logic */
          {

            $("#search-filter-clear").click(function () {
              setPeriod("", "");
            });

            $("#search-filter-set").click(function () {
              setPeriod(
                      $("#search-from").val(),
                      $("#search-to").val());
              searchPhotos(tags);
            });

            function setPeriod(fromValue, toValue) {
              searchFrom = fromValue;
              searchTo = toValue;
              $("#search-from").val(fromValue);
              $("#search-to").val(toValue);
            }
          }

          /* Helper functions */
        }

        /*$(document).on('click', '.play_slide', function (event) {

          $url = encodeURIComponent($(this).data('url'));
          $id = $(this).data('id');
          $image = encodeURIComponent($(this).data('image_url'));
          window.open('search-slideshow.html?image_id=' + $id + '&url=' + $url);

        });
		*/
		
				  var defaultRPP = 100; // default Results Per Page value
		  var imagesTotal;
		  var currImageNumber = 0;
		  var imagesStack = [];

        $(document).on('click', '.play_slide', function () {
		
		$("#images-loading").addClass('loading-slider');
		  
		  items = [];
		  
		  sliderImagesUrl = $(this).data('call_url');
		  var image_id = $(this).data('id');
		  
          //window.open('slideshow.html?image_id=' + image_id + '&page=' + page_id + '&url=' + encodeURIComponent(imagesUrl));

		  //sliderImagesUrl = imagesUrl;
		  
		  imageID = image_id;
	//	  pageID = page_id;		
	
		  swiperSliderCallURL(sliderImagesUrl, imageID, 0);
		  
        });

		function swiperSliderCallURL(sliderImagesUrl, imageID, auto_play_var){
			//console.log(imageID);
		  $.ajax({
			url: sliderImagesUrl,
			headers: {
			  "x-auth-key": "ladygaga#1"
			}
		  }).done(function (data) {

			var i = 0;

			imagesTotal = (defaultRPP > data.total_items) ? data.total_items : defaultRPP;
			//console.log('imagesTotal = ', imagesTotal);
			//console.log(data);
			items = [];
			data.items.forEach(function (item, index) {

			  if (imageID == item.id){
				startSliderIndex = index;
				//console.log(imageID);
				//console.log(index);
			  }

			  var imageUrl = item.resources[item.resources.length - 1].url;
			  var mainImageWidth = item.resources[item.resources.length - 1].width;
			  var mainImageHeight = item.resources[item.resources.length - 1].height;

			  var imageSource = item.source_name;

			  var imageTags = item.tags;
			  imageTags = imageTags.toString();
			  var replacedTags = imageTags.split(',').join(', ');

			  imageUrl = imageUrl;

			  var imageCaption = '<h3>' + item.name + '</h3><p>' + imageSource + '</p>';
			  
			  items[i] = {
				src: imageUrl,
				w: mainImageWidth,
				h: mainImageHeight,
				title: imageCaption,
			  };
			  i++;
			  
			});


			openPhotoSwipe(startSliderIndex);
			//console.log(startSliderIndex);
			$("#images-loading").removeClass('loading-slider');
						
			if (auto_play_var == 1) {
			  $('.pswp__button--autoplay').trigger('click');
			}
			
		  });

		}
	  /* Full Screen Swiper Code */

	  var openPhotoSwipe = function (startSliderIndex) {
		
		var pswpElement = document.querySelectorAll('.pswp')[0];

		//console.log(startSliderIndex);
		
		if (startSliderIndex > 0) {
		  startSliderIndex = startSliderIndex;
		} else {
		  startSliderIndex = 0;
		}

		// define options (if needed)
		var options = {
		  // history & focus options are disabled on CodePen        
		  index: startSliderIndex,
		  history: false,
		  focus: false,
		  closeOnScroll: false,
		  pinchToClose: false,
		  modal: false,		  shareEl: false,		  
		  showAnimationDuration: 0,
		  hideAnimationDuration: 0

		};

		var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);
		gallery.init();

		gallery.listen('close', function () {
		  window.close();
		 //gallery.destroy();
		});

		/************************ [Auto play code start] ****************************/

		if ($('.pswp__button--autoplay').length === 0)
		  $('<button class="pswp__button pswp__button--autoplay" title="AutoPlay"></button>').insertAfter('.pswp__button--zoom');

		var _autoplayId = null;

		$('.pswp__button--autoplay').on('click', function (event) {

		  event.preventDefault();

		  if (_autoplayId) {

			clearInterval(_autoplayId);
			_autoplayId = null;
			$('.pswp__button--autoplay').removeClass('stop');

		  } else {
			_autoplayId = setInterval(function () {
			  gallery.next();
			}, 7000);
			$('.pswp__button--autoplay').addClass('stop');


		  }
		});

		/************************ [Auto play code end] ****************************/

	  };
		

      });</script>

    <script>!function (d, s, id) {
        var js, fjs = d.getElementsByTagName(s)[0], p = /^http:/.test(d.location) ? 'http' : 'https';
        if (!d.getElementById(id)) {
          js = d.createElement(s);
          js.id = id;
          js.src = p + '://platform.twitter.com/widgets.js';
          fjs.parentNode.insertBefore(js, fjs);
        }
      }(document, 'script', 'twitter-wjs');</script>

    <script src="js/jquery-1.9.1.min.js"></script>
    <script src="http://code.jquery.com/ui/1.10.4/jquery-ui.js"></script>    
    <script src="js/ion.rangeSlider.js"></script>

    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.4/themes/smoothness/jquery-ui.css"> 
  </body>
</html>
